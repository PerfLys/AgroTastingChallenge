---
import AnimatedText from "@/components/ui/AnimatedText.astro";
import { generateWebpUrl } from "@/utils/generatedWebp";

interface Props {
  heroImage?: string;
  heroSubtitle?: string;
  title: string;
  buttonPrimaryText: string;
  buttonPrimaryUrl: string;
  buttonSecondaryText: string;
  buttonSecondaryUrl: string;
}

const {
  heroImage,
  heroSubtitle,
  title,
  buttonPrimaryText,
  buttonPrimaryUrl,
  buttonSecondaryText,
  buttonSecondaryUrl,
} = Astro.props;

// Build-time optimized hero background (static WebP in public/_generated/img)
const heroBg1x = heroImage
  ? await generateWebpUrl(heroImage, {
      width: 1600,
      height: 900,
      fit: "cover",
      quality: 82,
      variant: "hero-1x",
    })
  : null;
const heroBg2x = heroImage
  ? await generateWebpUrl(heroImage, {
      width: 2400,
      height: 1350,
      fit: "cover",
      quality: 82,
      variant: "hero-2x",
    })
  : null;
---

{heroBg1x && (
  <link rel="preload" as="image" href={heroBg1x} fetchpriority="high" />
)}

{heroImage ? (
  <>
    {/* Hero Image Section - starts right after header spacer */}
    <div class="relative w-full -mt-16 sm:-mt-20">
      {/* Hidden image for SEO and accessibility */}
      <img
        src={heroBg1x ?? heroImage}
        srcset={heroBg2x ? `${heroBg1x} 1x, ${heroBg2x} 2x` : undefined}
        alt={title}
        class="absolute w-px h-px -m-px overflow-hidden whitespace-nowrap border-0 p-0"
        style="clip: rect(0, 0, 0, 0); clip-path: inset(50%);"
        loading="eager"
        fetchpriority="high"
        decoding="async"
        aria-hidden="true"
      />
      {/* Background Image */}
      <div
        class="relative w-full min-h-[60vh] md:min-h-[70vh] bg-cover bg-center bg-no-repeat"
        style={
          heroBg1x
            ? `background-image: url('${heroBg1x}'); background-image: -webkit-image-set(url('${heroBg1x}') 1x, url('${heroBg2x ?? heroBg1x}') 2x); background-image: image-set(url('${heroBg1x}') 1x, url('${heroBg2x ?? heroBg1x}') 2x);`
            : `background-image: url('${heroImage}');`
        }
        role="img"
        aria-label={title}
      >
        {/* Dark overlay for text readability */}
        <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/50 to-black/40"></div>
        
        {/* Gradient transition at bottom */}
        <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-white dark:from-neutral-950 to-transparent"></div>
        
        {/* Content overlay */}
        <div class="relative z-10 site-container mx-auto px-4 pt-20 md:pt-28 lg:pt-36 pb-16">
          <div class="max-w-3xl">
            <h1 class="mb-4">
              <AnimatedText
                content={title}
                delay={0.1}
                duration={0.5}
                stagger={0.06}
                class="text-5xl leading-tight md:text-4xl lg:text-6xl font-brand text-white drop-shadow-lg"
              />
            </h1>

            {heroSubtitle && (
              <div class="mb-6">
                <AnimatedText
                  content={heroSubtitle}
                  delay={0.3}
                  duration={0.5}
                  stagger={0.02}
                  class="text-lg md:text-xl text-white/90 drop-shadow-md font-medium"
                />
              </div>
            )}

            <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
              <a
                href={buttonPrimaryUrl}
                class="flex justify-center items-center px-5 py-3 rounded-xl bg-white text-neutral-900 font-medium text-sm hover:bg-neutral-100 transition-colors w-full sm:w-auto shadow-lg hover:shadow-xl"
              >
                {buttonPrimaryText}
              </a>
              <a
                href={buttonSecondaryUrl}
                class="flex justify-center items-center px-5 py-3 rounded-xl border-2 border-white text-white font-medium text-sm hover:bg-white/10 transition-colors w-full sm:w-auto backdrop-blur-sm"
              >
                {buttonSecondaryText}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </>
) : (
  <div class="relative site-container z-20 w-full mx-auto mt-16 px-4 md:mt-18 lg:mt-20 xl:px-0">
    <div class="relative w-full px-4 flex flex-col items-center justify-between md:flex-row mb-16 gap-8">
      <div class="relative w-full md:max-w-[520px] md:w-1/2 text-center sm:text-left sm:-mt-8">
        <h1 class="mb-6">
          <AnimatedText
            content={title}
            delay={0.1}
            duration={0.5}
            stagger={0.06}
            class="text-5xl leading-tight md:text-4xl lg:text-6xl font-brand"
          />
        </h1>

        {heroSubtitle && (
          <div class="mb-6">
            <p class="text-lg md:text-xl text-neutral-700 dark:text-neutral-300 font-medium">
              {heroSubtitle}
            </p>
          </div>
        )}

        <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
          <a
            href={buttonPrimaryUrl}
            class="flex justify-center items-center px-5 py-3 rounded-xl bg-primary text-white font-medium text-sm hover:bg-primary/90 transition-colors w-full sm:w-auto"
          >
            {buttonPrimaryText}
          </a>
          <a
            href={buttonSecondaryUrl}
            class="flex justify-center items-center px-5 py-3 rounded-xl border-2 border-primary text-primary font-medium text-sm hover:bg-primary/10 transition-colors w-full sm:w-auto"
          >
            {buttonSecondaryText}
          </a>
        </div>
      </div>
    </div>
  </div>
)}

