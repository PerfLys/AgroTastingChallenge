---
interface Props {
  photos: string[];
  altPrefix?: string;
}

const { photos, altPrefix = "Photo" } = Astro.props;
const galleryId = `gallery-${Math.random().toString(36).slice(2)}`;
---

{photos.length === 0 ? (
  <p class="mt-3 text-sm leading-7 text-neutral-700 dark:text-neutral-300">
    Aucune photo n’est publiée pour le moment.
  </p>
) : (
  <>
    <div class="mt-5 grid grid-cols-2 sm:grid-cols-3 gap-3" data-gallery-root={galleryId}>
      {photos.map((src, idx) => (
        <button
          type="button"
          class="group overflow-hidden rounded-2xl border border-neutral-200 dark:border-neutral-700 bg-white/60 dark:bg-neutral-950/20 text-left"
          data-photo={src}
          aria-label={`Voir la photo ${idx + 1}`}
        >
          <img
            src={src}
            alt={`${altPrefix} ${idx + 1}`}
            class="w-full h-full object-cover aspect-[4/3] group-hover:scale-[1.03] transition-transform duration-300"
            loading="lazy"
          />
        </button>
      ))}
    </div>

    <dialog class="atc-lightbox rounded-2xl p-0 border border-dashed border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-950">
      <form method="dialog" class="flex items-center justify-between px-4 py-3 border-b border-dashed border-neutral-200 dark:border-neutral-800">
        <span class="text-sm text-neutral-700 dark:text-neutral-200">Aperçu</span>
        <button class="text-sm px-3 py-1.5 rounded-xl border border-neutral-200 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-900">
          Fermer
        </button>
      </form>
      <img alt="Aperçu" class="max-w-[92vw] max-h-[82vh] object-contain bg-black/5 dark:bg-white/5" />
    </dialog>

    <script is:inline>
      (() => {
        const rootAttr = {galleryId: `${galleryId}`};
        const root = document.querySelector(`[data-gallery-root="${rootAttr.galleryId}"]`);
        if (!root) return;

        const dialog = root.parentElement?.querySelector("dialog.atc-lightbox");
        const dialogImg = dialog?.querySelector("img");
        if (!dialog || !dialogImg) return;

        root.addEventListener("click", (e) => {
          const btn = e.target instanceof Element ? e.target.closest("button[data-photo]") : null;
          if (!btn) return;
          const src = btn.getAttribute("data-photo");
          if (!src) return;
          dialogImg.setAttribute("src", src);
          dialog.showModal();
        });

        dialog.addEventListener("click", (e) => {
          if (e.target === dialog) dialog.close();
        });
      })();
    </script>
  </>
)}

<style is:global>
  dialog.atc-lightbox::backdrop {
    background: rgba(0, 0, 0, 0.5);
  }
</style>


